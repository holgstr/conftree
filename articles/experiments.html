<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Experiments • conftree</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Experiments">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">conftree</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/conftree.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/experiments.html">Experiments</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="http://github.com/holgstr/conftree" aria-label="Github"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Experiments</h1>
            
      

      <div class="d-none name"><code>experiments.Rmd</code></div>
    </div>

    
    
<p>We compare R2P with R2P+ for subgroup detection in regression data.
For each data set and subgroup detection method, we measure
heterogeneity <em>across</em> groups with the variance of the subgroup
means
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>a</mi><msub><mi>r</mi><mrow><mi>a</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Var_{ac}</annotation></semantics></math>)
and homogeneity <em>within</em> groups with the mean subgroup variance
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>a</mi><msub><mi>r</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Var_{in}</annotation></semantics></math>).
For well-identified subgroups,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>a</mi><msub><mi>r</mi><mrow><mi>a</mi><mi>c</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Var_{ac}</annotation></semantics></math>
should be high and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mi>a</mi><msub><mi>r</mi><mrow><mi>i</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">Var_{in}</annotation></semantics></math>
should be low. Further, we are interested in the mean interval width
across groups and the total number of subgroups identified,
respectively. Specifically, we are interested in the performance for
small data set with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">n = 100</annotation></semantics></math>,
as R2P and R2P+ can be expected to perform more similarly the larger a
data set is. Therefore, we sample 100 observations from each data set
500 times, and aggregate the results. The aggregation also alleviates
the randomness induced by the CV splits in R2P (split conformal
prediction) and R2P+ (CV+).</p>
<div class="section level2">
<h2 id="prerequisites">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://holgstr.github.io/conftree/">"conftree"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="http://partykit.r-forge.r-project.org/partykit/" class="external-link">"partykit"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/bethatkinson/rpart" class="external-link">"rpart"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://tidymodels.tidymodels.org" class="external-link">"tidymodels"</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h2>
<p>For this experiment, we use 6 regression data sets. Data sets are
retrieved from <a href="https://www.openml.org/" class="external-link">OpenML</a> and
identified via their unique ID. A detailed description can be found on
the corresponding OpenML website entry.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://mlr3oml.mlr-org.com" class="external-link">"mlr3oml"</a></span><span class="op">)</span></span>
<span><span class="co"># Bikes (n = 727, k = 10, target = "count")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">bikes</span>, package <span class="op">=</span> <span class="st">"conftree"</span><span class="op">)</span></span>
<span><span class="co"># Abalone (n = 6497, k = 8, target "rings")</span></span>
<span><span class="va">abalone</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3oml.mlr-org.com/reference/odt.html" class="external-link">odt</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">44956</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co"># Diamonds (n = 53940, k = 10, target "price")</span></span>
<span><span class="va">diamonds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3oml.mlr-org.com/reference/odt.html" class="external-link">odt</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">42225</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co"># Elevators (n = 16599, k = 18, target "Goal")</span></span>
<span><span class="va">elevators</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3oml.mlr-org.com/reference/odt.html" class="external-link">odt</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">216</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">elevators</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">16</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">elevators</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">16</span><span class="op">]</span>, <span class="va">as.numeric</span><span class="op">)</span></span>
<span><span class="co"># Miami Housing (n = 13932, k = 15, target "SALE_PRC")</span></span>
<span><span class="va">miami</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3oml.mlr-org.com/reference/odt.html" class="external-link">odt</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">43093</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">[</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">miami</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">16</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">miami</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">16</span><span class="op">]</span>, <span class="va">as.numeric</span><span class="op">)</span></span>
<span><span class="co"># Wines (n = 6497, k = 11, target "quality")</span></span>
<span><span class="va">wines</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3oml.mlr-org.com/reference/odt.html" class="external-link">odt</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fl">287</span><span class="op">)</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<p>We rearrange each data set such that the target column is the last
column in the data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">abalone</span> <span class="op">&lt;-</span> <span class="va">abalone</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">abalone</span><span class="op">)</span>, <span class="st">"rings"</span><span class="op">)</span>, <span class="st">"rings"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">diamonds</span> <span class="op">&lt;-</span> <span class="va">diamonds</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">diamonds</span><span class="op">)</span>, <span class="st">"price"</span><span class="op">)</span>, <span class="st">"price"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">elevators</span> <span class="op">&lt;-</span> <span class="va">elevators</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">elevators</span><span class="op">)</span>, <span class="st">"Goal"</span><span class="op">)</span>, <span class="st">"Goal"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">miami</span> <span class="op">&lt;-</span> <span class="va">miami</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">miami</span><span class="op">)</span>, <span class="st">"SALE_PRC"</span><span class="op">)</span>, <span class="st">"SALE_PRC"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">wines</span> <span class="op">&lt;-</span> <span class="va">wines</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">wines</span><span class="op">)</span>, <span class="st">"quality"</span><span class="op">)</span>, <span class="st">"quality"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">datasets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"abalone"</span> <span class="op">=</span> <span class="va">abalone</span>, <span class="st">"bikes"</span> <span class="op">=</span> <span class="va">bikes</span>, <span class="st">"diamonds"</span> <span class="op">=</span> <span class="va">diamonds</span>, <span class="st">"elevators"</span> <span class="op">=</span> <span class="va">elevators</span>, <span class="st">"miami"</span> <span class="op">=</span> <span class="va">miami</span>, <span class="st">"wines"</span> <span class="op">=</span> <span class="va">wines</span><span class="op">)</span></span></code></pre></div>
<p>We standardize the target variables so results are more comparable
across data sets.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datasets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"abalone"</span> <span class="op">=</span> <span class="va">abalone</span>, <span class="st">"bikes"</span> <span class="op">=</span> <span class="va">bikes</span>, <span class="st">"diamonds"</span> <span class="op">=</span> <span class="va">diamonds</span>, <span class="st">"elevators"</span> <span class="op">=</span> <span class="va">elevators</span>, <span class="st">"miami"</span> <span class="op">=</span> <span class="va">miami</span>, <span class="st">"wines"</span> <span class="op">=</span> <span class="va">wines</span><span class="op">)</span></span>
<span><span class="va">datasets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">datasets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">last</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>  <span class="va">df</span><span class="op">[[</span><span class="va">last</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="va">last</span><span class="op">]</span><span class="op">]</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="va">last</span><span class="op">]</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">df</span><span class="op">[[</span><span class="va">last</span><span class="op">]</span><span class="op">]</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">df</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="experiments">Experiments<a class="anchor" aria-label="anchor" href="#experiments"></a>
</h2>
<div class="section level3">
<h3 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h3>
<p>We use a random forest base learner and set the R2P/R2P+
hyperparameters to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo>=</mo><mn>0.5</mn></mrow><annotation encoding="application/x-tex">\lambda = 0.5</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>γ</mi><mo>=</mo><mn>0.01</mn></mrow><annotation encoding="application/x-tex">\gamma = 0.01</annotation></semantics></math>
and <code>max_groups</code> is left at the default of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>10</mn><annotation encoding="application/x-tex">10</annotation></semantics></math>.
In R2P+, we use <code>cv_folds = 20</code>. Further, we set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>0.2</mn></mrow><annotation encoding="application/x-tex">\alpha = 0.2</annotation></semantics></math>,
which means at least 4 observations must be placed in any potential
subgroup. Note that setting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
to this relatively large value allows us to study R2P and R2P+ in a
comparable setting, since for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>100</mn></mrow><annotation encoding="application/x-tex">n = 100</annotation></semantics></math>
we do not want to limit the ability to detect subgroups by the
theoretical requirements of the conformal guarantees, which asks
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>≥</mo><mfrac><mn>1</mn><mrow><msub><mi>n</mi><mi>l</mi></msub><mo>+</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">\alpha \geq \frac{1}{n_{l}+1}</annotation></semantics></math>
for a subgroup of size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>n</mi><mi>l</mi></msub><annotation encoding="application/x-tex">n_l</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">process_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">## Learner</span></span>
<span>  <span class="va">forest</span> <span class="op">&lt;-</span> <span class="fu">rand_forest</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>     <span class="fu">set_mode</span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>     <span class="fu">set_engine</span><span class="op">(</span><span class="st">"ranger"</span><span class="op">)</span></span>
<span>  <span class="co">## R2P</span></span>
<span>  <span class="va">g_r2p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/r2p.html">r2p</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  learner <span class="op">=</span> <span class="va">forest</span>,</span>
<span>  cv_folds <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  gamma <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  max_groups <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span></span>
<span>  <span class="co">## Learner</span></span>
<span>  <span class="va">forest</span> <span class="op">&lt;-</span> <span class="fu">rand_forest</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>     <span class="fu">set_mode</span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>     <span class="fu">set_engine</span><span class="op">(</span><span class="st">"ranger"</span><span class="op">)</span></span>
<span>  <span class="co">## R2P+</span></span>
<span>  <span class="va">g_r2pp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/r2p.html">r2p</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data</span>,</span>
<span>  target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">]</span>,</span>
<span>  learner <span class="op">=</span> <span class="va">forest</span>,</span>
<span>  cv_folds <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  gamma <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  lambda <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  max_groups <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">g_r2p</span>, <span class="va">g_r2pp</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We define functions to run the experiments and aggregate the results.
For each of the four measures, we report means and standard deviations
for R2P and R2P+, respectively.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">run_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">rep</span>, <span class="va">n_sample</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Initialize result variables</span></span>
<span>  <span class="va">n_groups_r2p</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">n_groups_r2pp</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">avg_width_r2p</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">avg_width_r2pp</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">vac_r2p</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">vac_r2pp</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">vin_r2p</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  <span class="va">vin_r2pp</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>  </span>
<span>  <span class="co"># Loop through repetitions</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">rep</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sample_s</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="va">n_sample</span><span class="op">)</span>, <span class="op">]</span></span>
<span>    <span class="va">pis</span> <span class="op">&lt;-</span> <span class="fu">process_data</span><span class="op">(</span><span class="va">sample_s</span><span class="op">)</span></span>
<span>    <span class="va">n_groups_r2p</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_groups</span></span>
<span>    <span class="va">n_groups_r2pp</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pis</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">n_groups</span></span>
<span>    <span class="va">group_ids_r2p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/partykit/man/nodeids.html" class="external-link">nodeids</a></span><span class="op">(</span><span class="va">pis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">tree</span>, terminal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">group_ids_r2pp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/partykit/man/nodeids.html" class="external-link">nodeids</a></span><span class="op">(</span><span class="va">pis</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">tree</span>, terminal <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">avg_width_r2p</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="../reference/tree_width.html">tree_width</a></span><span class="op">(</span><span class="va">pis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">tree</span>,</span>
<span>                                                    <span class="va">pis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">valid_set</span>,</span>
<span>                                                    <span class="va">pis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">alpha</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="va">group_ids_r2p</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">avg_width_r2pp</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="../reference/tree_width.html">tree_width</a></span><span class="op">(</span><span class="va">pis</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">tree</span>,</span>
<span>                                                    <span class="va">pis</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">valid_set</span>,</span>
<span>                                                    <span class="va">pis</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">alpha</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="va">group_ids_r2pp</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">vac_r2p</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">var_ac</span></span>
<span>    <span class="va">vac_r2pp</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pis</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">var_ac</span></span>
<span>    <span class="va">vin_r2p</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pis</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">var_in</span></span>
<span>    <span class="va">vin_r2pp</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pis</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">info</span><span class="op">$</span><span class="va">var_in</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Create data frames to store results</span></span>
<span>  <span class="va">df_r2p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    n_groups <span class="op">=</span> <span class="va">n_groups_r2p</span>,</span>
<span>    avg_width <span class="op">=</span> <span class="va">avg_width_r2p</span>,</span>
<span>    var_ac <span class="op">=</span> <span class="va">vac_r2p</span>,</span>
<span>    var_in <span class="op">=</span> <span class="va">vin_r2p</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">df_r2pp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    n_groups <span class="op">=</span> <span class="va">n_groups_r2pp</span>,</span>
<span>    avg_width <span class="op">=</span> <span class="va">avg_width_r2pp</span>,</span>
<span>    var_ac <span class="op">=</span> <span class="va">vac_r2pp</span>,</span>
<span>    var_in <span class="op">=</span> <span class="va">vin_r2pp</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Return both data frames</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"r2p"</span> <span class="op">=</span> <span class="va">df_r2p</span>, <span class="st">"r2p_plus"</span> <span class="op">=</span> <span class="va">df_r2pp</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">agg_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">results</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">results</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="va">sds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">means</span>, sd <span class="op">=</span> <span class="va">sds</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="run">Run<a class="anchor" aria-label="anchor" href="#run"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">final_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">datasets</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="fu">agg_data</span><span class="op">(</span><span class="fu">run_data</span><span class="op">(</span><span class="va">x</span>, <span class="fl">3</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">final_res</span></span>
<span><span class="co">#&gt; $abalone</span></span>
<span><span class="co">#&gt; $abalone$r2p</span></span>
<span><span class="co">#&gt;                mean        sd</span></span>
<span><span class="co">#&gt; n_groups  2.6666667 1.1547005</span></span>
<span><span class="co">#&gt; avg_width 1.8166667 0.2353897</span></span>
<span><span class="co">#&gt; var_ac    0.2279547 0.2205045</span></span>
<span><span class="co">#&gt; var_in    1.0618355 0.3454554</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $abalone$r2p_plus</span></span>
<span><span class="co">#&gt;                mean         sd</span></span>
<span><span class="co">#&gt; n_groups  3.6666667 1.52752523</span></span>
<span><span class="co">#&gt; avg_width 1.5193333 0.02713546</span></span>
<span><span class="co">#&gt; var_ac    0.4000822 0.05608998</span></span>
<span><span class="co">#&gt; var_in    0.9065626 0.35667382</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $bikes</span></span>
<span><span class="co">#&gt; $bikes$r2p</span></span>
<span><span class="co">#&gt;                mean        sd</span></span>
<span><span class="co">#&gt; n_groups  4.3333333 2.0816660</span></span>
<span><span class="co">#&gt; avg_width 0.9711111 0.1378539</span></span>
<span><span class="co">#&gt; var_ac    0.4695717 0.2750048</span></span>
<span><span class="co">#&gt; var_in    0.4570496 0.1131504</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $bikes$r2p_plus</span></span>
<span><span class="co">#&gt;                mean         sd</span></span>
<span><span class="co">#&gt; n_groups  6.6666667 1.52752523</span></span>
<span><span class="co">#&gt; avg_width 0.8142024 0.31138134</span></span>
<span><span class="co">#&gt; var_ac    0.6245510 0.39656978</span></span>
<span><span class="co">#&gt; var_in    0.1670088 0.07195536</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $diamonds</span></span>
<span><span class="co">#&gt; $diamonds$r2p</span></span>
<span><span class="co">#&gt;                mean         sd</span></span>
<span><span class="co">#&gt; n_groups  5.3333333 1.15470054</span></span>
<span><span class="co">#&gt; avg_width 0.7769722 0.12531046</span></span>
<span><span class="co">#&gt; var_ac    1.4202163 0.82088529</span></span>
<span><span class="co">#&gt; var_in    0.2285215 0.02099067</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $diamonds$r2p_plus</span></span>
<span><span class="co">#&gt;                mean         sd</span></span>
<span><span class="co">#&gt; n_groups  8.6666667 1.52752523</span></span>
<span><span class="co">#&gt; avg_width 0.7657397 0.14711878</span></span>
<span><span class="co">#&gt; var_ac    1.1651925 0.24199986</span></span>
<span><span class="co">#&gt; var_in    0.2599337 0.09150731</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $elevators</span></span>
<span><span class="co">#&gt; $elevators$r2p</span></span>
<span><span class="co">#&gt;                 mean         sd</span></span>
<span><span class="co">#&gt; n_groups  3.66666667 0.57735027</span></span>
<span><span class="co">#&gt; avg_width 1.40166667 0.09355257</span></span>
<span><span class="co">#&gt; var_ac    0.06274157 0.06961815</span></span>
<span><span class="co">#&gt; var_in    0.64951748 0.08538501</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $elevators$r2p_plus</span></span>
<span><span class="co">#&gt;                 mean         sd</span></span>
<span><span class="co">#&gt; n_groups  3.66666667 1.15470054</span></span>
<span><span class="co">#&gt; avg_width 1.20555556 0.20483959</span></span>
<span><span class="co">#&gt; var_ac    0.07688822 0.12223940</span></span>
<span><span class="co">#&gt; var_in    0.72646717 0.09006617</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $miami</span></span>
<span><span class="co">#&gt; $miami$r2p</span></span>
<span><span class="co">#&gt;                 mean         sd</span></span>
<span><span class="co">#&gt; n_groups  1.66666667 0.57735027</span></span>
<span><span class="co">#&gt; avg_width 0.83500000 0.17514280</span></span>
<span><span class="co">#&gt; var_ac    0.04400611 0.04515967</span></span>
<span><span class="co">#&gt; var_in    0.80988630 0.05082024</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $miami$r2p_plus</span></span>
<span><span class="co">#&gt;                mean        sd</span></span>
<span><span class="co">#&gt; n_groups  5.3333333 1.5275252</span></span>
<span><span class="co">#&gt; avg_width 0.7351190 0.1346956</span></span>
<span><span class="co">#&gt; var_ac    0.2985685 0.2762918</span></span>
<span><span class="co">#&gt; var_in    0.7479204 0.3472475</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $wines</span></span>
<span><span class="co">#&gt; $wines$r2p</span></span>
<span><span class="co">#&gt;                mean        sd</span></span>
<span><span class="co">#&gt; n_groups  4.3333333 0.5773503</span></span>
<span><span class="co">#&gt; avg_width 2.0713333 0.1289393</span></span>
<span><span class="co">#&gt; var_ac    0.1174885 0.1384298</span></span>
<span><span class="co">#&gt; var_in    0.8241989 0.2203610</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $wines$r2p_plus</span></span>
<span><span class="co">#&gt;                mean         sd</span></span>
<span><span class="co">#&gt; n_groups  6.0000000 2.00000000</span></span>
<span><span class="co">#&gt; avg_width 1.8676389 0.08653669</span></span>
<span><span class="co">#&gt; var_ac    0.1177254 0.04117139</span></span>
<span><span class="co">#&gt; var_in    0.8702724 0.08039390</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Holger Löwe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
